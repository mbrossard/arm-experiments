#!/bin/bash

sudo apt install -y mount dosfstools parted

dd if=/dev/zero of=disk.img bs=1M count=1024

sudo losetup /dev/loop0 disk.img
sudo parted -s /dev/loop0 mklabel msdos
sudo parted -s /dev/loop0 unit cyl mkpart primary fat32 -- 0 16
sudo parted -s /dev/loop0 set 1 boot on
sudo parted -s /dev/loop0 unit cyl mkpart primary ext2 -- 16 -2
sudo mkfs.vfat -n Boot /dev/loop0p1
sudo mkfs.ext4 -L Root /dev/loop0p2

mkdir root
sudo mount /dev/loop0p2 ./root

sudo umount ./root
sudo losetup -d /dev/loop0
rmdir root
